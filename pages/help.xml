<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta content="text/html; charset=us-ascii" http-equiv="content-type"/>
        <title>EC-OpenShift Plugin</title>
        <link rel="stylesheet" href="../../plugins/@PLUGIN_NAME@/pluginhelp.css" type="text/css" media="screen"/>
    </head>
    <body>
        <div class="help">
            <h1>EC-OpenShift</h1>
            <p>Plugin version @PLUGIN_VERSION@</p>
            <hr style="margin-left: -10px; margin-top: 10px; height: 1px; width: 100%; color: #5981BD;" noshade="noshade" />
            <h3 id="overview">Overview</h3>
            <p>
                EC-OpenShift plugin integrates with the <a href="https://www.openshift.com/">OpenShift container platform</a> allowing you to coordinate and manage microservices-based applications deployments and releases on both on-premise and hosted OpenShift offerings. 
                <ul>
                    <li>
                        In case of on-premise setup, plugin helps you install <a href="https://www.openshift.org/">OpenShift Origin</a> on VMWare setup right from importing underlying hosts (VMs) from OVF template, installing OpenShift Origin using <a href="https://github.com/openshift/openshift-ansible">Ansible scripts</a> and performs post installation steps like creation of project, service accout and router (with same name as project name). This makes deployment of any micro-service simple and straight forward. For the detailed requirements about OVF template, see <a href="#ProvisionClusterOnESX">Provision Cluster on ESX procedure details.</a>
                    <br/> Plugin also supports various installation topologies based on requirements. Supported topologies are:
                    <br/> 
                        <ul>
                            <li><b>Minimal</b> : Sets up one OpenShift master, embedded etcd and user supplied number of nodes. Suitable for setting up OpenShift cluster for evaluation purpose or for development setup.  </li>
                            <li><b>Multiple Etcd</b> : Sets up one OpenShift master, separate cluster of three etcd instances and user supplied number of nodes.</li>
                            <li><b>Multiple Etcd + HAProxy</b> : Highly available setup with three OpenShift masters, cluster of three etcd instances and user supplied number of nodes. Suitable for production environment.</li>
                        </ul>
                    </li>
                    <li>
                        For hosted OpenShift offerings, plugin assumes that you have a service account which has full access on projects that you intend to use through this plugin.
                    </li>
                </ul>
            </p>
            <h1>Contents</h1>
            <ul>
			    <li><a href="#overview">Overview</a></li>
				<li><a href="#prerequisites">Prerequisites</a></li>
                <li><a href="#CreateConfiguration">Plugin Configuration</a></li>
                <li><a href="#procedures">Plugin Procedures</a></li>
                <ul>
                    <li><a href="#CheckCluster">Check Cluster</a></li>
                    <li><a href="#DeployService">Deploy Service</a></li>
                    <li><a href="#ProvisionClusterOnESX">Provision Cluster on ESX</a></li>
                    <li><a href="#UndeployService">Undeploy Service</a></li>
                </ul>
                <li><p><a href="#rns">Release Notes</a></p></li>
            </ul>
			<h2 id="prerequisites">Prerequisites</h2>
			<ol>
			<li>EC-Kubernetes plugin version 1.0.*</li>
            <li>EC-ESX plugin version 2.3.* (Only for running the <i>Provision Cluster on ESX</i> procedure)</li>
			<li>RedHat OpenShift 3 cluster - RedHat OpenShift Online, RedHat OpenShift Dedicated, or RedHat OpenShift On-premise.</li>
			<li>A service account with cluster access on RedHat OpenShift
            <p>Service accounts provide a flexible way to control API access without sharing a regular userâ€™s credentials. Every service account has an associated username that can be granted roles, just like a regular user.<br/>
            Run the following commands to create a service account, grant the required access for deploying services in the OpenShift cluster, and retrieve the bearer token that will be used when creating the plugin configuration.
            The service account bearer token will be used to authenticate against the Kubernetes and OpenShift APIs for managing projects (namespaces) and deploying services.
            <pre>
    # Login using cluster admin credentials
    oc login cluster_IP_here:8443 --username=cluster_admin_user_here --password=admin_user_password_here

    # Create a service account in the current project say 'us-project-test'. Full name of the serviceaccount will be system:serviceaccount:us-project-test:erobot
    oc create serviceaccount erobot


    # Grant the roles to allow the service account create resources in the cluster such as projects.

    sudo ./oadm --config='openshift.local.config/master/openshift-master.kubeconfig' policy add-cluster-role-to-user cluster-admin system:serviceaccount:us-project-test:erobot
    sudo ./oadm --config='openshift.local.config/master/openshift-master.kubeconfig' policy add-cluster-role-to-user cluster-reader system:serviceaccount:us-project-test:erobot
    sudo ./oadm --config='openshift.local.config/master/openshift-master.kubeconfig' policy add-cluster-role-to-user admin system:serviceaccount:us-project-test:erobot

    # Describe the service account to discover the secret token name
    oc describe serviceaccount erobot

    # Describe the secret token to get the token value, say 'erobot-token-8zlsh'
    oc describe secret erobot-token-8zlsh
    or
    oc describe secret erobot-token-8zlsh > oc-secret-with-token.txt

    # You will need to provide this token value in the plugin configuration for the Service Account Key value.
            </pre>

            </p>
            </li>
			</ol>
            <p>
			</p>
            <div id="CreateConfiguration">
                <a name='CreateConfiguration' id="CreateConfiguration"> </a>
                <h2>Plugin Configurations</h2>
                <!-- If the plugin has separate configurations then include
                     this section, otherwise omit this whole section. We don't
                     need to have a configuration section that just says "There
                     is no configuration for this plugin." -->
                <p>
                    Plugin configurations are sets of parameters that apply
                    across some or all of the plugin procedures. They
                    reduce repetition of common values, create
                    predefined parameter sets for end users, and
                    securely store credentials where needed. Each configuration
                    is given a unique name that is entered in designated
                    parameters on procedures that use them.<br /><br />
                </p>
                <!-- For all parameters, the parameter name should be *exactly*
                     the same as it appears in the Parameter Panel, and the first
                     sentence(s) of the description should be the same as the tooltip (if
                     there is one). After that, the parameter description can go into
                     greater detail about the parameter including valid value ranges and
                     examples. -->
                <h3>Creating Plugin Configurations</h3>
                <p>To create plugin configurations in ElectricFlow,
                do these steps:</p>
                <ul>
                <li>Go to <b>Administration</b> &gt; <b>Plugins</b> to open the Plugin Manager.</li>
                    <li>Find the EC-OpenShift row.</li>
                    <li>Click <b>Configure</b> to open the
                    OpenShift Configurations page.</li>
                    <li>Click <b>Create Configuration</b>.</li>
                    <li>Enter the following configuration parameters for communicating with the OpenShift cluster:</li>
                </ul>
				<table class="grid">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="required">Configuration</td>

                        <td>Provide a unique name for the
                        configuration, keeping in mind that you may
                        need to create additional configurations
                        over time. </td>
                    </tr>

                    <tr>
                        <td>Description</td>
                        <td>Provide some description for configuration.</td>
                    </tr>

                    <tr>
                        <td class="required">OpenShift API Endpoint</td>
                        <td>The endpoint at which OpenShift API can be reached. Must be an IP address or a resolvable DNS name.</td>
                    </tr>
					<tr>
                        <td class="required">Service Account</td>

                        <td><i>Name</i>: Service account name.<br />
                         <i>Private Key</i>: Provide the bearer token for the service account that has access to create resources in the OpenShift cluster. This bearer token will be used to deploying services on the OpenShift cluster.</td>
                    </tr>
                    <tr>
                        <td>Kubernetes Version</td>
                        <td>Kubernetes version running on the Openshift cluster master. The parameter will default to '1.6' if no value is specified.</td>
                    </tr>
                    <tr>
                        <td>Test Connection</td>
                        <td>Check this checkbox to verify connectivity to the Openshift cluster master.</td>
                    </tr>
                    <tr>
                        <td>Debug level</td>
                        <td>Log level to use for logging output. Error=4, Warning=3, Info=2, Debug=1. Info by default.</td>
                    </tr>
                </tbody>
                </table>
                <p><img src="../../plugins/@PLUGIN_KEY@/images/ConfigurationParameters.png" alt="screenshot" /></p>
            </div>
            <h1 id="procedures">Plugin Procedures</h1>
            <p>
                IMPORTANT: For all parameter descriptions below, required parameters are shown in
                <span class="required">bold italics</span>. Please note that some of names given in ElectricFlow UI will be modified to comply with the naming conventions of Kubernetes. Specifically characters such as "space , _ " will be converted to "-". Such parameters are marked with an asterisk (*).
            </p>
            <div id="CheckCluster">
                <h2>Check Cluster</h2>
                <p>
                    The procedure checks if the OpenShift cluster exists and is reachable using the cluster details provided in the plugin configuration.
                </p>
                <h3>Check Cluster Parameters</h3>
                <table class="grid">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="required">Configuration</td>
                            <td>The name of an existing configuration which holds all the connection information for OpenShift cluster.</td>
                        </tr>
                        <tr>
                            <td class="required">OpenShift Project</td>
                            <td>The name of the OpenShift project to which the services and deployments should be deployed. If the project does not exist, it will be created during service deployment.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="DeployService">
                <h2>Deploy service</h2>
                <p>This procedure deploys a service, creating or updating pod definitions, service and deployment in the OpenShift project on the cluster. The OpenShift project(namespace) is created if it does not exist.</p>
                <h3>Deploy Service Parameters</h3>
                <table class="grid">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="required">Service Name</td>
                            <td>The name of the service in ElectricFlow that encapsulates the service to be deployed on the OpenShift cluster.</td>
                        </tr>
                        <tr>
                            <td>Service Revision ID</td>
                            <td>Revision Id of the service in ElectricFlow.</td>
                        </tr>
                        <tr>
                            <td class="required">Project Name</td>
                            <td>The name of the project that the service belongs to. In case of an application-level service it also owns the application.</td>
                        </tr>
                        <tr>
                            <td>Application Name</td>
                            <td>The name of the application that the service belongs to. Not applicable for a top-level service.</td>
                        </tr>
                        <tr>
                            <td>Application Revision ID</td>
                            <td>Revision Id of the application version that the service belongs to.</td>
                        </tr>  
                        <tr>
                            <td class="required">Cluster name</td>
                            <td>The name of the cluster in ElectricFlow that encapsulates the OpenShift cluster on which the service is to be deployed.</td>
                        </tr>                        
                        <tr>
                            <td>Cluster or environment project name</td>
                            <td>The name of the project that the cluster belongs to if it is a top-level project cluster. Or the name of the project that the environment belongs to if it is an environment-scoped cluster.</td>
                        </tr>
                        <tr>
                            <td>Environment Name</td>
                            <td>The name of the environment that the cluster belongs to. Not applicable for a top-level project cluster.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="ProvisionClusterOnESX">
                <h2>Provision Cluster on ESX</h2>
                <p>The procedure checks if the OpenShift cluster exists and is reachable with provided details. If not, then provisions a new one.<br/>
                    The procedure uses ESX plugin's import procedure to setup underlying VMs.For system requirements, see <a href="https://docs.openshift.com/enterprise/3.0/install_config/install/prerequisites.html#install-config-install-prerequisites">here</a>.For networking requirements, see <a href="https://docs.openshift.org/latest/install_config/install/prerequisites.html#prereq-network-access">here</a>. <br/>
                    Once VMs are available, procedure uses <a href="https://github.com/openshift/openshift-ansible">ansible scripts</a> provided by OpenShift to setup openshift cluster. <br/>Bellow are the prerequisite to use this procedure:
                    <ol>
                        <li> Ansible (v2.2.0.0) must be installed on ElectricFlow agent machines and <b>'ansible-playbook'</b> command should be included in PATH. </li>
                        <li> <b>'htpasswd'</b> must be installed and included in PATH on ElectricFlow agent machine.</li>
                        <li> ElectricFlow agent machine should have passwordless SSH access to imported VMs.<br/>
                            <li> Plugin passes the hostname to OVF template using OVF property "--prop:hostname=some_hostname" while importing using OVF tool.</li>
                            The OVF template must have mechanism (<a href="https://github.com/vmware/open-vm-tools">'open-vm-tools'</a> is one such example) to read this OVF property and set its hostname accordingly. </li>
                        <li> It should also add "127.0.0.1 some_hostname some_hostname.domain_name" entry to /etc/hosts file.</li>
                        <li> <a href="https://buildlogs.centos.org/centos/7/paas/x86_64/openshift-origin/origin-docker-excluder-1.4.0-2.el7.noarch.rpm">'origin-docker-excluder'</a> and <a href="https://buildlogs.centos.org/centos/7/paas/x86_64/openshift-origin/origin-excluder-1.4.0-2.el7.noarch.rpm">'origin-excluder'</a> RPMs must be already installed on OVF template. </li>
                    </ol>
                </p>
                <h3>Provision Cluster on ESX Parameters</h3>
                <table class="grid">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="required">ESX plugin configuration</td>
                            <td>ESX plugin configuration name. ESX plugin is used create underlying VM hosts for OpenShift cluster setup by importing OVF templates.</td>
                        </tr>
                        <tr>
                            <td class="required">ESX Datastore</td>
                            <td>Name of the datastore to be used.</td>
                        </tr>
                        <tr>
                            <td class="required">ESX Host</td>
                            <td>Name of the host where virtual machines will be imported.</td>
                        </tr>
                        <tr>
                            <td class="required">Path to OVF Tool</td>
                            <td>Install location to ovftool binary.</td>
                        </tr>
                        <tr>
                            <td class="required">Path to OVF package</td>
                            <td>Absoulte path to the directory where OVF packages are stored.</td>
                        </tr>
                        <tr>
                            <td class="required">OpenShift Project</td>
                            <td>The name of the OpenShift project to which the services and deployments should be deployed. If the project does not exist, it will be created during service deployment.The project name must match the regex [a-z0-9]([-a-z0-9]*[a-z0-9])? (e.g. 'my-name' or '123-abc')</td>
                        </tr>
                        <tr>
                            <td class="required">OpenShift Service Account</td>
                            <td>The name of service account to create after OpenShift cluster is setup.Service account name must match the regex [a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)* (e.g. 'example.com')</td>
                        </tr>
                        <tr>
                            <td class="required">OpenShift VM name prefix</td>
                            <td>Prefix to be prepended to VM names and their hostnames to uniquely distinguish from other OpenShift setups.</td>
                        </tr>
                        <tr>
                            <td class="required">OpenShift Plugin Configuration Name</td>
                            <td>Name OpenShift plugin configaration to create after OpenShift cluster is setup.</td>
                        </tr>
                        <tr>
                            <td>OpenShift Master Node Memory (in MBs)</td>
                            <td>Memory in MB for master VM(s).</td>
                        </tr>
                        <tr>
                            <td>OpenShift Master Node CPUs</td>
                            <td>Number of CPUs for master VM(s).</td>
                        </tr>
                        <tr>
                            <td>OpenShift Worker Node Memory (in MBs)</td>
                            <td>Memory in MB for node VMs.</td>
                        </tr>
                        <tr>
                            <td>OpenShift Worker Node CPUs</td>
                            <td>Number of CPUs for node VMs.</td>
                        </tr>
                        <tr>
                            <td class="required">Topology</td>
                            <td>Indicates which OpenShift topology to deploy.Following topologies are supported:
                                <ol>
                                    <li>Minimal (1 Master, 1 Etcd, both on same machine)</li>
                                    <li>Multiple Etcd (1 Master, 3 Etcd, Master and Etcd on separate machines)</li>
                                    <li>Multiple Etcd + HAProxy (3 Masters, 3 Etcd, 1 HAProxy)</li>
                                </ol>
                            </td>
                        </tr>
                        <tr>
                            <td class="required">Number of worker nodes</td>
                            <td>Number of nodes to add to OpenShift cluster.</td>
                        </tr>
                        <tr>
                            <td class="required">Domain Name</td>
                            <td>Domain name to use for imported OpenShift VMs.(e.g. xyz.yourcompany.com)</td>
                        </tr>
                        <tr>
                            <td class="required">User login to use</td>
                            <td>The user ansible will use to login to VMs.This user should have passwordless SSH access preconfigured to imported VMs.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="UndeployService">
                <h2>Undeploy service</h2>
                <p>This procedure undeploys a previously deployed service on the OpenShift cluster. The OpenShift project(namespace) is not removed.</p>
                <h3>Undeploy Service Parameters</h3>
                <table class="grid">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="required">Service Name</td>
                            <td>The name of the service in ElectricFlow that encapsulates the service that was previously deployed on the OpenShift cluster.</td>
                        </tr>
                        <tr>
                            <td>Service Revision ID</td>
                            <td>Revision Id of the service in ElectricFlow.</td>
                        </tr>
                        <tr>
                            <td class="required">Project Name</td>
                            <td>The name of the project that the service belongs to. In case of an application-level service it also owns the application.</td>
                        </tr>
                        <tr>
                            <td>Application Name</td>
                            <td>The name of the application that the service belongs to. Not applicable for a top-level service.</td>
                        </tr>
                        <tr>
                            <td>Application Revision ID</td>
                            <td>Revision Id of the application version that the service belongs to.</td>
                        </tr>
                        <tr>
                            <td class="required">Environment Name</td>
                            <td>The name of the environment that the cluster belongs to. Not applicable for a top-level project cluster.</td>
                        </tr>
                        <tr>
                            <td>Environment Project Name</td>
                            <td>The name of the project that the environment belongs to. If not specified, the environment is assumed to be in the same project as the service.</td>
                        </tr>
                        <tr>
                            <td>Cluster Name</td>
                            <td>The name of the cluster in the environment on which the service was previously deployed. If not specified, the application tier mapping will be used to find the cluster name.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h1 id="rns">Release Notes</h1>

            <!-- For each release, create an h2 section describing new and revised procedures, enhancements, and JIRA fixes.
            See the following examples for how to write the release note items, which include:
            - Phrases starting with "Added the N procedure to ...", "Removed the X parameter from the ...", "Fixed the issue where  ...",
            and so on.
            - Descriptions of new features or functionality supported by the plugin.
            -->
            <h2>EC-OpenShift-1.3.1</h2>
            <ul>
                <li>Removed unused parameter <i>additionalAttributes</i> from container mapping configuration.</li>
            </ul>
            <h2>EC-OpenShift-1.3.0</h2>
            <ul>
                <li>Renamed <i>Provision Cluster</i> procedure to a more specific <i>Provision Cluster on ESX</i>. The parameters in the renamed procedure remain the same.</li>
                <li>Updated the 'provisionCluster' operation used during service deployment to use the 'Check Cluster' procedure that checks that the OpenShift cluster exists and is available for service deployments.</li>
                <li>Added procedure <i>Undeploy Service</i> to undeploy a previously deployed service.</li>
                <li>Added 'kubernetesVersion' parameter in the plugin configuration to allow the user to identify the Kubernetes version running on the Openshift cluster master. The parameter will default to '1.6' if no value is specified.</li>
            </ul>
        </div>
	</body>
</html>	
